# Ethereumå•èŠ‚ç‚¹éƒ¨ç½²

é€šè¿‡æœ¬æ–‡æ‰€è¿°æ–¹æ³•å’Œé¡¹ç›®ä¸­çš„è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿçš„æ­å»ºå¥½è‡ªå·±çš„ç§é“¾å•èŠ‚ç‚¹è¿›è¡Œå¼€å‘æµ‹è¯•ã€‚

ä»“åº“ä¸­åŒ…å«çš„å·¥å…·æœ‰ï¼š

* ä¸€ä¸ªæµ‹è¯•è´¦æˆ·å¯¼å…¥è„šæœ¬ï¼Œåœ¨é¦–æ¬¡éƒ¨ç½²æ—¶å°†äº”ä¸ªæµ‹è¯•è´¦æˆ·ç§é’¥å¯¼å…¥ä»¥å¤ªåŠèŠ‚ç‚¹ã€‚
* ä¸€ä¸ªgenesis.jsoné…ç½®æ–‡ä»¶ï¼Œä¸ºå¯¹åº”çš„äº”ä¸ªæµ‹è¯•è´¦æˆ·æä¾›åˆå§‹èµ„é‡‘ï¼ˆä»¥å¤ªå¸ï¼‰ï¼Œæ–¹ä¾¿å¼€å‘æµ‹è¯•ã€‚
* ä¸€ä¸ªå¿«é€Ÿå¯åŠ¨ç§æœ‰é“¾èŠ‚ç‚¹å¹¶è¿›å…¥äº¤äº’æ¨¡å¼çš„è„šæœ¬ã€‚

**æµ‹è¯•è´¦æˆ·ç§é’¥æ˜¯æ”¾åœ¨Githubä¸Šçš„å…¬å¼€æ•°æ®ï¼Œåƒä¸‡ä¸è¦ç”¨äºæ­£å¼ç¯å¢ƒä¸­æˆ–è€…å…¬æœ‰é“¾ä¸Šã€‚å¦‚æœåœ¨æµ‹è¯•ç¯å¢ƒä¹‹å¤–çš„åœ°æ–¹ä½¿ç”¨è¿™äº›ç§é’¥ï¼Œä½ çš„èµ„é‡‘å°†ä¼šè¢«çªƒå–ï¼**

## å‡†å¤‡

1. åœ¨æœ¬åœ°å®‰è£…å¥½[go-ethereum](https://github.com/ethereum/go-ethereum)å¯ä»¥æ‰§è¡Œ`geth`å‘½ä»¤ã€‚å¦‚æœæ“ä½œç³»ç»Ÿæ˜¯ubuntu, å®‰è£…å®˜æ–¹çš„ethereumå®‰è£…åŒ…å³å¯ã€‚

   ```shell
   Ubuntu 14.04ç¯å¢ƒï¼Œå…¶ä»–å‡†å¤‡

   æ›´æ”¹Ubuntuçš„aptæºä¸ºé˜¿é‡Œçš„
   å‚è€ƒï¼š https://www.cnblogs.com/lyon2014/p/4715379.html
   æ›´æ”¹/etc/apt.d/sources.list
   root@geth-node01:~# cat /etc/apt/sources.list
   deb http://mirrors.aliyun.com/ubuntu/ trusty main multiverse restricted universe
   deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main multiverse restricted universe
   deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main multiverse restricted universe
   deb http://mirrors.aliyun.com/ubuntu/ trusty-security main multiverse restricted universe
   deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main multiverse restricted universe
   deb-src http://mirrors.aliyun.com/ubuntu/ trusty main multiverse restricted universe
   deb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main multiverse restricted universe
   deb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main multiverse restricted universe
   deb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main multiverse restricted universe
   deb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main multiverse restricted universe

   äº‘ç¯å¢ƒçš„VMï¼Œæ ¹æ®æƒ…å†µéœ€è¦æ‰‹å·¥æ›´æ”¹/etc/resolve.confï¼Œå¯ç”¨å…¬ç½‘åŸŸåæœåŠ¡å™¨8.8.8.8
   root@geth-node01:~# cat /etc/resolv.conf 
   # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
   #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
   nameserver 8.8.8.8

   ç„¶åæ‰§è¡Œ
   sudo apt-get update
   sudo apt-get install software-properties-common
   sudo add-apt-repository -y ppa:ethereum/ethereum
   sudo apt-get update
   sudo apt-get install ethereum
   ```

2. å®‰è£…gitå·¥å…·`sudo apt-get install git`ï¼Œå°†æœ¬ä»“åº“é€šè¿‡`git clone`å‘½ä»¤ä¸‹è½½åˆ°æœ¬åœ°ã€‚

3. å®‰è£…[expect](http://expect.sourceforge.net/)ï¼Œå·¥å…·è„šæœ¬ç”¨å®ƒæ¥è‡ªåŠ¨åŒ–ä¸€äº›è¿‡ç¨‹ã€‚ä¾‹å¦‚åœ¨ubuntuä¸Š: `sudo apt-get install expect`

## å¯åŠ¨geth

1. è¿›å…¥æœ¬ä»“åº“ç›®å½•: `cd ethereum-bootstrap/1.SingleNode`

2. å¯¼å…¥æµ‹è¯•è´¦æˆ·ç§é’¥: `./import_keys.sh`ï¼Œç¼ºçœçš„é’±åŒ…å¯†ç è®¾ç½®ä¸º123456

3. åˆå§‹åŒ–blockchain: `./init_private_blockchain.sh`
   ```
   root@geth-node01:~/ethereum-bootstrap/1.SingleNode# ./init_private_blockchain.sh 
   INFO [04-12|15:47:41] Maximum peer count                       ETH=25 LES=0 total=25
   INFO [04-12|15:47:41] Allocated cache and file handles         database=/root/ethereum-bootstrap/1.SingleNode/data/geth/chaindata cache=16 handles=16
   INFO [04-12|15:47:41] Writing custom genesis block 
   INFO [04-12|15:47:41] Persisted trie from memory database      nodes=7 size=1.31kB time=70.539Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
   INFO [04-12|15:47:41] Successfully wrote genesis state         database=chaindata                                                 hash=194258â€¦f0efa3
   INFO [04-12|15:47:41] Allocated cache and file handles         database=/root/ethereum-bootstrap/1.SingleNode/data/geth/lightchaindata cache=16 handles=16
   INFO [04-12|15:47:41] Writing custom genesis block 
   INFO [04-12|15:47:41] Persisted trie from memory database      nodes=7 size=1.31kB time=498.815Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
   INFO [04-12|15:47:41] Successfully wrote genesis state         database=lightchaindata                                                 hash=194258â€¦f0efa3
   ```

4. å¯åŠ¨ç§æœ‰é“¾èŠ‚ç‚¹: `./start_private_blockchain.sh`. å¯åŠ¨æˆåŠŸåå¯ä»¥çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡º:

  ```
  root@geth-node01:~/ethereum-bootstrap/1.SingleNode# ./start_private_blockchain.sh 
  INFO [04-12|15:47:45] Maximum peer count                       ETH=25 LES=0 total=25
  INFO [04-12|15:47:45] Starting peer-to-peer node               instance=Geth/v1.8.3-stable-329ac18e/linux-amd64/go1.10
  INFO [04-12|15:47:45] Allocated cache and file handles         database=/root/ethereum-bootstrap/1.SingleNode/data/geth/chaindata cache=768 handles=512
  WARN [04-12|15:47:45] Upgrading database to use lookup entries 
  INFO [04-12|15:47:45] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Constantinople: <nil> Engine: unknown}"
  INFO [04-12|15:47:45] Disk storage enabled for ethash caches   dir=/root/ethereum-bootstrap/1.SingleNode/data/geth/ethash count=3
  INFO [04-12|15:47:45] Disk storage enabled for ethash DAGs     dir=/root/.ethash                                          count=2
  INFO [04-12|15:47:45] Initialising Ethereum protocol           versions="[63 62]" network=20180412
  INFO [04-12|15:47:45] Database deduplication successful        deduped=0
  INFO [04-12|15:47:45] Loaded most recent local header          number=0 hash=194258â€¦f0efa3 td=131072
  INFO [04-12|15:47:45] Loaded most recent local full block      number=0 hash=194258â€¦f0efa3 td=131072
  INFO [04-12|15:47:45] Loaded most recent local fast block      number=0 hash=194258â€¦f0efa3 td=131072
  INFO [04-12|15:47:45] Regenerated local transaction journal    transactions=0 accounts=0
  INFO [04-12|15:47:45] Starting P2P networking 
  INFO [04-12|15:47:45] RLPx listener up                         self="enode://e6f8732c332d66fedd1bd74cc6fa6b528ea24db76f903f1d4bdf7b2aaaa45ac2c17a056225075bbebb48052c7097dd331de6983aa58b051f64c5622f4b3daed1@[::]:30303?discport=0"
  INFO [04-12|15:47:45] IPC endpoint opened                      url=/root/ethereum-bootstrap/1.SingleNode/data/geth.ipc
  INFO [04-12|15:47:45] HTTP endpoint opened                     url=http://127.0.0.1:8545                               cors=* vhosts=localhost
  Welcome to the Geth JavaScript console!

  instance: Geth/v1.8.3-stable-329ac18e/linux-amd64/go1.10
  INFO [04-12|15:47:46] Etherbase automatically configured       address=0xbD2d69E3e68e1ab3944a865B3E566CA5c48740da
  coinbase: 0xbd2d69e3e68e1ab3944a865b3e566ca5c48740da
  at block: 0 (Thu, 01 Jan 1970 00:00:00 UTC)
   datadir: /root/ethereum-bootstrap/1.SingleNode/data
   modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

  > 
  ```

5. æ­¤æ—¶ä»¥å¤ªåŠäº¤äº’å¼æ§åˆ¶å°å·²ç»å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æµ‹è¯•å’Œå¼€å‘äº†ã€‚

æ³¨æ„ï¼šå·¥å…·è„šæœ¬å‡è®¾ä½ çš„gethå®‰è£…åœ¨é»˜è®¤ä½ç½®, å¯ä»¥ç›´æ¥é€šè¿‡`geth`æ‰§è¡Œã€‚å¦‚æœ`geth`å‘½ä»¤å®‰è£…åœ¨éæ ‡å‡†çš„ä½ç½®ï¼Œå¯ä»¥è®¾ç½®`GETH`ç¯å¢ƒå˜é‡æŒ‡å®šgethå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚

## é€šè¿‡æŒ–çŸ¿æ¥ä¸ºaccountå‘æ”¾ether
æŸ¥çœ‹è´¦å·ä½™é¢ï¼š
```
> web3.eth.getBalance(web3.eth.accounts[0])
4e+30
```
å¯ä»¥é€šè¿‡æŒ–çŸ¿çš„æ–¹å¼ç»™ç¬¬ä¸€ä¸ªè´¦å·å‘è¡Œetherï¼š

ç¬¬ä¸€æ¬¡å¯åŠ¨æŒ–çŸ¿ï¼Œä¼šå‡ºç°`Generating DAG in progress`å½“è¾¾åˆ°100%çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°`Commit new mining work`è¯´æ˜æŒ–çŸ¿æˆåŠŸã€‚

```
> miner.start(1)
INFO [04-12|15:56:25] Generating DAG in progress               epoch=1 percentage=6  elapsed=23.167s
INFO [04-12|15:56:25] Successfully sealed new block            number=5 hash=17798fâ€¦35e7e5
INFO [04-12|15:56:25] ğŸ”¨ mined potential block                  number=5 hash=17798fâ€¦35e7e5
INFO [04-12|15:56:25] Commit new mining work                   number=6 txs=0 uncles=0 elapsed=187.16Âµs
INFO [04-12|15:56:28] Generating DAG in progress               epoch=1 percentage=7  elapsed=26.578s
INFO [04-12|15:56:31] Generating DAG in progress               epoch=1 percentage=8  elapsed=29.890s
INFO [04-12|15:56:34] Successfully sealed new block            number=6 hash=161716â€¦3096c7
INFO [04-12|15:56:34] ğŸ”— block reached canonical chain          number=1 hash=e8c64aâ€¦dba8e9
INFO [04-12|15:56:34] ğŸ”¨ mined potential block                  number=6 hash=161716â€¦3096c7
INFO [04-12|15:56:34] Commit new mining work                   number=7 txs=0 uncles=0 elapsed=148.93Âµs
INFO [04-12|15:56:35] Generating DAG in progress               epoch=1 percentage=9  elapsed=33.215s
INFO [04-12|15:56:39] Generating DAG in progress               epoch=1 percentage=10 elapsed=37.036s
INFO [04-12|15:56:42] Generating DAG in progress               epoch=1 percentage=11 elapsed=40.755s
INFO [04-12|15:56:46] Generating DAG in progress               epoch=1 percentage=12 elapsed=44.342s
INFO [04-12|15:56:49] Generating DAG in progress               epoch=1 percentage=13 elapsed=47.660s
INFO [04-12|15:56:53] Generating DAG in progress               epoch=1 percentage=14 elapsed=50.926s
INFO [04-12|15:56:56] Generating DAG in progress               epoch=1 percentage=15 elapsed=54.258s
INFO [04-12|15:56:56] Successfully sealed new block            number=7 hash=265246â€¦80d943
INFO [04-12|15:56:56] ğŸ”— block reached canonical chain          number=2 hash=47020câ€¦93bf48
INFO [04-12|15:56:56] ğŸ”¨ mined potential block                  number=7 hash=265246â€¦80d943
INFO [04-12|15:56:56] Commit new mining work                   number=8 txs=0 uncles=0 elapsed=162.679Âµs
```
éœ€è¦è°ƒç”¨miner.stopæ¥åœæ­¢æŒ–çŸ¿ï¼š
```
> miner.stop()
true
> web3.eth.getBalance(web3.eth.accounts[0])
4.00000000092e+30
```
å…¶ä»–çš„ä¸€äº›å‘½ä»¤ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„è´¦å·ï¼š

```
> personal.newAccount("123456")
"0xbf65120529316beed5858ed9b8add67a976f371e"
```

åˆ—å‡ºæ‰€æœ‰çš„è´¦å·ï¼š

```
> eth.accounts
["0xbd2d69e3e68e1ab3944a865b3e566ca5c48740da", "0x9da26fc2e1d6ad9fdd46138906b0104ae68a65d8", "0xca9f427df31a1f5862968fad1fe98c0a9ee068c4", "0x3ae88fe370c39384fc16da2c9e768cf5d2495b48", "0x81063419f13cab5ac090cd8329d8fff9feead4a0", "0xbf65120529316beed5858ed9b8add67a976f371e"]
```

ä»¥ä»¥å¤ªå¸å•ä½æ˜¾ç¤ºè´¦æˆ·ä½™é¢ï¼ˆä¸€ä»¥å¤ªå¸ç­‰äº1e18 weiï¼‰ï¼š

```
> web3.fromWei(eth.getBalance(eth.accounts[0]), "ether")
4000000000920
```

åœ¨å¯¹è´¦å·è¿›è¡Œæ“ä½œï¼ˆèŠ±è´¹ã€è½¬å‡ºè´¦ï¼‰ä¹‹å‰ï¼Œéœ€è¦å…ˆå¯¹è´¦å·è¿›è¡Œè§£é”ï¼š

```
> personal.unlockAccount(web3.eth.accounts[0])
```



